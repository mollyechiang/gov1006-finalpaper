---
title: "Final Paper"
author: "Chelsea Marlborough"
date: "4/13/2020"
output: bookdown::pdf_document2
bibliography: bib.bib
link-citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(Hmisc)
library(bookdown)
library(ggplot2)
library(reshape)
library(AER)
library(grid)
library(plyr)
library(tidyverse)
library(dplyr)
library(tinytex)
library(plotly)

```
### Abstract
Boas, Hidalgo, and Richardson (2013) show that campaign donations can buy policy outcomes in the case of Brazil with public -
works firms contributing to ruling - party legislative candidates. I was able to replicate all the images within this paper. I have not yet been able to start my extension as I have been switching papers.

### Introduction
This paper by Taylor C. Boas, F. Daniel Hidalgo, and Neal P. Richardson uses data from publicly released governmental datasets by the government to create a unique dataset for testing. This dataset was made up of results of the 2006 federal-deputy elections, demographic information on candidates, and a complete list of each candidate’s registered campaign donations from the Superior Electoral Tribunal (Boas, Hidalgo & Richardson 2013). Additionally, years of founding, industrial classification code, and which state headquarters were located in were also collected for firms that had donated to these candidates from the Ministry of Finance (Boas, Hidalgo & Richardson 2013). Regression discontinuity was used to measure the effect of government contracts for politician's donor firms. This design is popular with election studies because the assumptions are normally clear and their implications can be empirically tested (Boas, Hidalgo & Richardson 2013). Analysis was done at the level of the candidate rather than the firms. Results showed that an electoral victory brought substantial government contracts with campaign donors, but only public-works firms in the Worker’s Party (PT)(Boas, Hidalgo & Richardson 2013) . Treatment effects on public-works donors to PT candidates were large, positive and consistently significant, resulting in government contracts to public-works donors being 14 to 39 times larger than the donations made to the candidate (Boas, Hidalgo & Richardson 2013). Overall, this analysis confirms the larger research question as to whether or not campaign donations can buy policy outcomes (Boas, Hidalgo & Richardson 2013).

The next step to this project was replicating Boas, Hidalgo and Richardson's code. Their code and data are publically available on Harvard Dataverse. In order to replicate the results, I ran their original code with minor modifications in R. All code for replication is available on my Github repository ^[GitHub repository: https://github.com/chelseamarlborough/gov1006-milestone4]. 

### Literature Review



### Tables and Figures
```{r loading data, include = FALSE}

set.seed(13)
load("raw-data/spoils_of_victory_replication_data.RData")

options(warn = -1)

```

```{r heteroskedastically robust SE function, include = FALSE}

summaryR.lm <-
function(model,
type = c("hc3", "hc0", "hc1", "hc2", "hc4"),
...) {
if (!require(car))
stop("Required car package is missing.")
type <- match.arg(type)
V <- hccm(model, type = type)
sumry <- summary(model)
table <- coef(sumry)
table[, 2] <- sqrt(diag(V))
table[, 3] <- table[, 1] / table[, 2]
table[, 4] <-
2 * pt(abs(table[, 3]), df.residual(model), lower.tail = FALSE)
sumry$coefficients <- table
p <- nrow(table)
hyp <- cbind(0, diag(p - 1))
sumry
}

reais.format <- function(x) {
paste("R\\$", prettyNum(round(x), big.mark = ","), sep = " ")
}

```

```{r discontinuity function, include = FALSE}

discont.plot <-
function(y,
force.var,
cluster,
treat,
span = .7,
n.boots = 100,
bins = 25,
xlab = "Forcing Variable",
ylab = "Outcome",
title = "",
degree = degree) {
data <-
data.frame(
y = y,
force.var = force.var,
cluster.id = cluster,
treat = treat
)
clusters <- unique(cluster)
for (i in 1:n.boots) {
bs.clusters <- data.frame(cluster.id = sample(clusters, replace = TRUE))
bs.data <-
merge(
bs.clusters,
data,
all.x = TRUE,
all.y = FALSE,
by.x = "cluster.id",
by.y = "cluster.id"
)
lo.treat <-
loess(
y ~ force.var,
data = bs.data[bs.data$treat == 1, ],
span = span,
surface = "direct",
degree = degree
)
lo.control <-
loess(
y ~ force.var,
data = bs.data[bs.data$treat == 0, ],
span = span,
surface = "direct",
degree = degree
)
lo.fit.treat <-
predict(lo.treat, newdata = data$force.var[data$treat == 1])
lo.fit.control <-
predict(lo.control, newdata = data$force.var[data$treat == 0])
if (i == 1) {
lo.treat.bs <- matrix(nrow = length(lo.fit.treat), ncol = n.boots)
lo.control.bs <-
matrix(nrow = length(lo.fit.control), ncol = n.boots)
}
lo.treat.bs[, i] <- lo.fit.treat
lo.control.bs[, i] <- lo.fit.control
if (i %% (0.1 * n.boots) == 0) {
# output progress for each p
cat(".")
}
}
lo.treat <-
loess(
y ~ force.var,
data = data[data$treat == 1, ],
span = span,
surface = "direct",
degree = degree
)
lo.control <-
loess(
y ~ force.var,
data = data[data$treat == 0, ],
span = span,
surface = "direct",
degree = degree
)
lo.fit.treat <-
predict(lo.treat, newdata = data$force.var[data$treat == 1])
lo.fit.control <-
predict(lo.control, newdata = data$force.var[data$treat == 0])
lo.results.treat <-
data.frame(
force.var = data$force.var[data$treat == 1],
y = data$y[data$treat == 1],
y.fit = lo.fit.treat,
conf.hi =  apply(lo.treat.bs, 1, quantile, probs = c(.025)),
conf.lo =  apply(lo.treat.bs, 1, quantile, probs = c(.975)),
treat = 1
)
lo.results.treat$bin <-
sapply(strsplit(gsub(
"^\\W|\\W$",
"",
cut(lo.results.treat$force.var, breaks = bins)
), ","), function(x)
sum(as.numeric(x)) / 2)
lo.results.treat <-
ddply(lo.results.treat, .(bin), transform, bin.mean = mean(y))
lo.results.control <-
data.frame(
force.var = data$force.var[data$treat == 0],
y = data$y[data$treat == 0],
y.fit = lo.fit.control,
conf.hi =  apply(lo.control.bs, 1, quantile, probs = c(.025)),
conf.lo =  apply(lo.control.bs, 1, quantile, probs = c(.975)),
treat = 0
)
lo.results.control$bin <-
sapply(strsplit(gsub(
"^\\W|\\W$",
"",
cut(lo.results.control$force.var, breaks = bins)
), ","), function(x)
sum(as.numeric(x)) / 2)
lo.results.control <-
ddply(lo.results.control, .(bin), transform, bin.mean = mean(y))
lo.results <- rbind(lo.results.treat, lo.results.control)
lo.results$treat <- as.factor(lo.results$treat)
ggplot(lo.results,
aes(
x = force.var,
y = y.fit,
group = treat,
color = treat
)) + geom_line(aes(y = y.fit), size = 1.5)  + geom_vline(xintercept = 0) + geom_ribbon(aes(ymin = conf.hi, ymax =
conf.lo), alpha = .2)  + geom_point(aes(x = bin, y = bin.mean)) + theme_bw()   + theme(legend.position = "none")  + scale_colour_brewer(palette =
"Set1")  + scale_x_continuous(xlab) +  scale_y_continuous(ylab) + labs(title = title) + theme(axis.title.x = element_text(vjust = .3)) + theme(plot.title = element_text(size = rel(.9)))
}

```

```{r loess estimating treatment effect function, include = FALSE}

boot.loess <- function(data,
index,
span = .75,
degree = 2) {
boot.data <- data[index, ]
lo.treat <-
loess(
y ~ force.var,
data = boot.data[boot.data$treat == 1, ],
span = span,
surface = "direct",
degree = degree
)
lo.cont <-
loess(
y ~ force.var,
data = boot.data[boot.data$treat == 0, ],
span = span,
surface = "direct",
degree = degree
)
lo.fit.tr <- predict(lo.treat, newdata = 0, se = TRUE)
lo.fit.co <- predict(lo.cont, newdata = 0, se = TRUE)
c(lo.fit.tr$fit - lo.fit.co$fit,
var.t = lo.fit.tr$se.fit + lo.fit.co$se.fit)
}

lo.ate <-
function(y,
treat,
force.var,
span = 1,
R = 500,
degree = 2,
replicates = FALSE) {
library(boot)
data <- data.frame(y, treat, force.var)
boot.out <-
boot(
data = data,
span = span,
statistic = boot.loess,
R  = R
)
ci.out <- boot.ci(boot.out, type = "stud")
lo.treat <-
loess(
y ~ force.var,
data = data[data$treat == 1, ],
span = span,
surface = "direct",
degree = degree
)
lo.cont <-
loess(
y ~ force.var,
data = data[data$treat == 0, ],
span = span,
surface = "direct",
degree = degree
)
lo.fit.tr <- predict(lo.treat, newdata = 0)
lo.fit.co <- predict(lo.cont, newdata = 0)
if (replicates == TRUE) {
list(
est = lo.fit.tr - lo.fit.co,
se = sd(boot.out$t[, 1]),
conf.int = c(ci.out$student[4], ci.out$student[5]),
tr.est = lo.fit.tr,
con.est = lo.fit.co,
boot.replicates = boot.out$t[, 1]
)
}
else{
list(
est = lo.fit.tr - lo.fit.co,
se = sd(boot.out$t[, 1]),
conf.int = c(ci.out$student[4], ci.out$student[5]),
tr.est = lo.fit.tr,
con.est = lo.fit.co
)
}
}

```

```{r mccrary density test function, include = FALSE}

mccrary.test <- function(force.var,
h = .75,
n.boots = 1000) {
##Note that this function assumes that the discontinuity is at 0
force.below <- force.var[force.var < 0]
force.below <-
force.below[force.below >= quantile(force.below, prob = .1)]
force.above <- force.var[force.var > 0]
force.above <-
force.above[force.above <= quantile(force.above, prob = .9)]
bin.width <-
2 * sd(c(force.above, force.below)) * 1 / sqrt(length(c(force.below, force.above)))
force.below.bin <-
data.frame(table(cut(
force.below, breaks = seq(0, min(force.below), by = -1 * bin.width)
)))
force.above.bin <-
data.frame(table(cut(
force.above, breaks = seq(0, max(force.above), by = bin.width)
)))
force.below.bin$Var1 <-
sapply(strsplit(gsub("^\\W|\\W$", "", force.below.bin$Var1), ","), function(x)
sum(as.numeric(x)) / 2)
force.above.bin$Var1 <-
sapply(strsplit(gsub("^\\W|\\W$", "", force.above.bin$Var1), ","), function(x)
sum(as.numeric(x)) / 2)
bin.freq <- rbind(force.below.bin, force.above.bin)
lo.fit.above <-
loess(Freq ~ Var1,
data = bin.freq[bin.freq$Var1 > 0, ],
degree = 1,
span = h)
lo.fit.below <-
loess(Freq ~ Var1,
data = bin.freq[bin.freq$Var1 < 0, ],
degree = 1,
span = h)
lo.predict <-
rbind(
data.frame(
bin.mid = bin.freq$Var1[bin.freq$Var1 < 0],
pred.dens = predict(lo.fit.below)
),
data.frame(
bin.mid = bin.freq$Var1[bin.freq$Var1 > 0],
pred.dens = predict(lo.fit.above)
)
)
wald.stat <-
log(predict(
loess(
pred.dens ~ bin.mid,
data = lo.predict[lo.predict$bin.mid < 0, ],
span = h,
degree = 1,
surface = "direct"
) ,
newdata = data.frame(bin.mid = 0)
)) - log(predict(
loess(
pred.dens ~ bin.mid,
data = lo.predict[lo.predict$bin.mid > 0, ],
span = h,
degree = 1,
surface = "direct"
) ,
newdata = data.frame(bin.mid = 0)
))

#use the bootstrap to calculate standard error
log.dis.bs <- matrix(nrow = n.boots)
for (i in 1:n.boots) {
force.above.bs <-
force.above[sample(1:length(force.above), replace = TRUE)]
force.below.bs <-
force.below[sample(1:length(force.below), replace = TRUE)]
force.below.bs <-
force.below.bs[force.below.bs >= quantile(force.below.bs, prob = .1)]
force.above.bs <-
force.above.bs[force.above.bs <= quantile(force.above.bs, prob = .9)]
bin.width <-
2 * sd(c(force.above.bs, force.below.bs)) * 1 / sqrt(length(c(force.below.bs, force.above.bs)))
force.below.bin <-
data.frame(table(cut(
force.below.bs, breaks = seq(0, min(force.below.bs), by = -1 * bin.width)
)))
force.above.bin <-
data.frame(table(cut(
force.above.bs, breaks = seq(0, max(force.above.bs), by = bin.width)
)))
force.below.bin$Var1 <-
sapply(strsplit(gsub(
"^\\W|\\W$", "", force.below.bin$Var1
), ","), function(x)
sum(as.numeric(x)) / 2)
force.above.bin$Var1 <-
sapply(strsplit(gsub(
"^\\W|\\W$", "", force.above.bin$Var1
), ","), function(x)
sum(as.numeric(x)) / 2)
bin.freq <- rbind(force.below.bin, force.above.bin)
lo.fit.above <-
loess(Freq ~ Var1,
data = bin.freq[bin.freq$Var1 > 0, ],
degree = 1,
span = h)
lo.fit.below <-
loess(Freq ~ Var1,
data = bin.freq[bin.freq$Var1 < 0, ],
degree = 1,
span = h)
lo.predict <-
rbind(
data.frame(
bin.mid = bin.freq$Var1[bin.freq$Var1 < 0],
pred.dens = predict(lo.fit.below)
),
data.frame(
bin.mid = bin.freq$Var1[bin.freq$Var1 > 0],
pred.dens = predict(lo.fit.above)
)
)

log.dis.bs[i] <-
log(predict(
loess(
pred.dens ~ bin.mid,
data = lo.predict[lo.predict$bin.mid < 0, ],
span = h,
degree = 1,
surface = "direct"
) ,
newdata = data.frame(bin.mid = 0)
)) - log(predict(
loess(
pred.dens ~ bin.mid,
data = lo.predict[lo.predict$bin.mid > 0, ],
span = h,
degree = 1,
surface = "direct"
) ,
newdata = data.frame(bin.mid = 0)
))
}
list(wald.stat = wald.stat,
se = sd(log.dis.bs, na.rm = TRUE))
}

```

```{r number of bootstrap samples, include = FALSE}

num.boots <- 1000

```

```{r parameters for loess estimator, include = FALSE}

span <- 1
lo.degree <- 1

```

```{r datasets of varioius samples, include = FALSE}

depfed_data$incumbent <- depfed.balance$incumbent
depfed_data$uf.sp <- ifelse(depfed_data$uf == "SP", 1, 0)
depfed_data$uf.mg <- ifelse(depfed_data$uf == "MG", 1, 0)
##Loess Data, Estimation Samples
lo.bw <- 40000
lo.all.data <-
depfed_data[abs(depfed_data$votemargin) < lo.bw &
depfed_data$donations > 0, ]
lo.all.pw.data <-
depfed_data[abs(depfed_data$votemargin) < lo.bw &
depfed_data$pw.donations > 0, ]
lo.coal.pw.data <-
depfed_data[abs(depfed_data$votemargin) < lo.bw &
depfed_data$pw.donations > 0 &
depfed_data$party %in% c('PMDB', 'PP', 'PV', 'PSB', 'PC do B', 'PDT', 'PL', 'PRONA'), ]
lo.pt.pw.data <-
depfed_data[abs(depfed_data$votemargin) < lo.bw &
depfed_data$pw.donations > 0 & depfed_data$party == "PT", ]

```

```{r loess balance samples, include = FALSE}

lo.all.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < lo.bw &
depfed.balance$donations > 0, ]
lo.all.pw.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < lo.bw &
depfed.balance$pw.donations > 0, ]
lo.coal.pw.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < lo.bw &
depfed.balance$pw.donations > 0 &
depfed.balance$party %in% c('PMDB', 'PP', 'PV', 'PSB', 'PC do B', 'PDT', 'PL', 'PRONA'), ]
lo.pt.pw.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < lo.bw &
depfed.balance$pw.donations > 0 & depfed.balance$party == "PT", ]

```

```{r local linear bindwith, include = FALSE}

ll.bw <- 25000
##Local Linear Data, Estimation Samples
ll.all.data <-
depfed_data[abs(depfed_data$votemargin) < ll.bw &
depfed_data$donations > 0, ]
ll.all.pw.data <-
depfed_data[abs(depfed_data$votemargin) < ll.bw &
depfed_data$pw.donations > 0, ]
ll.coal.pw.data <-
depfed_data[abs(depfed_data$votemargin) < ll.bw &
depfed_data$pw.donations > 0 &
depfed_data$party %in% c('PMDB', 'PP', 'PV', 'PSB', 'PC do B', 'PDT', 'PL', 'PRONA'), ]
ll.pt.pw.data <-
depfed_data[abs(depfed_data$votemargin) < ll.bw &
depfed_data$pw.donations > 0 & depfed_data$party == "PT", ]

```

```{r local linear data balance samples, include = FALSE}

ll.all.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < ll.bw &
depfed.balance$donations > 0, ]
ll.all.pw.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < ll.bw &
depfed.balance$pw.donations > 0, ]
ll.coal.pw.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < ll.bw &
depfed.balance$pw.donations > 0 &
depfed.balance$party %in% c('PMDB', 'PP', 'PV', 'PSB', 'PC do B', 'PDT', 'PL', 'PRONA'), ]
ll.pt.pw.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < ll.bw &
depfed.balance$pw.donations > 0 & depfed.balance$party == "PT", ]

```

```{r polynomial data estimation samples, include = FALSE}

poly.order <- 3
ply.bw <- 100000
ply.all.data <-
depfed_data[abs(depfed_data$votemargin) < ply.bw &
depfed_data$donations > 0, ]
ply.all.pw.data <-
depfed_data[abs(depfed_data$votemargin) < ply.bw &
depfed_data$pw.donations > 0, ]
ply.coal.pw.data <-
depfed_data[abs(depfed_data$votemargin) < ply.bw &
depfed_data$pw.donations > 0 &
depfed_data$party %in% c('PMDB', 'PP', 'PV', 'PSB', 'PC do B', 'PDT', 'PL', 'PRONA'), ]
ply.pt.pw.data <-
depfed_data[abs(depfed_data$votemargin) < ply.bw &
depfed_data$pw.donations > 0 & depfed_data$party == "PT", ]

```

```{r polynomial data balance samples, include = FALSE, cache=TRUE}

ply.all.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < ply.bw &
depfed.balance$donations > 0, ]
ply.all.pw.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < ply.bw &
depfed.balance$pw.donations > 0, ]
ply.coal.pw.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < ply.bw &
depfed.balance$pw.donations > 0 &
depfed.balance$party %in% c('PMDB', 'PP', 'PV', 'PSB', 'PC do B', 'PDT', 'PL', 'PRONA'), ]
ply.pt.pw.baldata <-
depfed.balance[abs(depfed.balance$votemargin) < ply.bw &
depfed.balance$pw.donations > 0 & depfed.balance$party == "PT", ]

```

```{r fig 1 balance tests, cache = TRUE}

bal.var <-
c(
"coalvotes",
"incumbent",
"contracts.0406",
"pw.con.0406",
"donations",
"pw.donations",
"donor.firms",
"pw.donor.firms",
"year.opened",
"commerce",
"manufacture",
"financial",
"cand.uf.sp",
"cand.uf.mg",
"cand.uf.rs",
"cand.uf.ba",
"cand.uf.rj",
"party.psdb",
"party.pfl",
"party.pt",
"party.pmdb",
"superior.edu",
"occ.pol",
"yob",
"individ.donations",
"occ.business",
"coalvotes",
"individual.donors",
"coalseats",
"agriculture",
"numb.company.recipients",
"total.company.donations",
"totalDonations.winners.firm",
"winners.donated.to"
)


lo.bal <- list()
lo.bal$all <- list()
lo.bal$all.pw <- list()
lo.bal$coal.pw <- list()
lo.bal$pt.pw <- list()

ll.bal <- list()
ll.bal$all <- list()
ll.bal$all.pw <- list()
ll.bal$coal.pw <- list()
ll.bal$pt.pw <- list()
length(ll.bal$pt.pw) <- length(bal.var)

ply.bal <- list()
ply.bal$all <- list()
ply.bal$all.pw <- list()
ply.bal$coal.pw <- list()
ply.bal$pt.pw <- list()
length(ply.bal$pt.pw) <- length(bal.var)

for (i in 1:length(bal.var)) {
print(paste("Checking Balance on", bal.var[i]))
lo.bal$all[[i]] <-
with(
lo.all.baldata,
lo.ate(
y = lo.all.baldata[, bal.var[i]],
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.bal$all[[i]]$sd <-
(sd(lo.all.baldata[lo.all.baldata$elected == 1 , bal.var[i]]) + sd(lo.all.baldata[lo.all.baldata$elected == 0 , bal.var[i]])) / 2
names(lo.bal$all)[i] <- bal.var[i]

lo.bal$all.pw[[i]] <-
with(
lo.all.pw.baldata,
lo.ate(
y = lo.all.pw.baldata[, bal.var[i]],
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.bal$all.pw[[i]]$sd <-
(sd(lo.all.pw.baldata[lo.all.pw.baldata$elected == 1 , bal.var[i]]) + sd(lo.all.pw.baldata[lo.all.pw.baldata$elected == 0 , bal.var[i]])) / 2
names(lo.bal$all.pw)[i] <- bal.var[i]

if (length(unique(lo.coal.pw.baldata[, bal.var[i]])) == 1) {
lo.bal$coal.pw[[i]] <- NA
}
if (length(unique(lo.coal.pw.baldata[, bal.var[i]])) > 1) {
lo.bal$coal.pw[[i]] <-
with(
lo.coal.pw.baldata,
lo.ate(
y = lo.coal.pw.baldata[, bal.var[i]],
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.bal$coal.pw[[i]]$sd <-
(sd(lo.coal.pw.baldata[lo.coal.pw.baldata$elected == 1 , bal.var[i]]) + sd(lo.coal.pw.baldata[lo.coal.pw.baldata$elected == 0 , bal.var[i]])) / 2
}
names(lo.bal$coal.pw)[i] <- bal.var[i]

if (length(unique(lo.pt.pw.baldata[, bal.var[i]])) == 1) {
lo.bal$pt.pw[[i]] <- NA
}
if (length(unique(lo.pt.pw.baldata[, bal.var[i]])) > 1) {
lo.bal$pt.pw[[i]] <-
with(
lo.pt.pw.baldata,
lo.ate(
y = lo.pt.pw.baldata[, bal.var[i]],
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.bal$pt.pw[[i]]$sd <-
(sd(lo.pt.pw.baldata[lo.pt.pw.baldata$elected == 1 , bal.var[i]]) + sd(lo.pt.pw.baldata[lo.pt.pw.baldata$elected == 0 , bal.var[i]])) / 2
}
names(lo.bal$pt.pw)[i] <- bal.var[i]

ll.bal$all[[i]] <-
summaryR.lm(lm(formula(
paste(bal.var[i], "~ elected*votemargin")
) , data = ll.all.baldata), type = "hc2")
ll.bal$all[[i]]$sd <-
(sd(ll.all.baldata[ll.all.baldata$elected == 1, bal.var[i]]) + sd(ll.all.baldata[ll.all.baldata$elected == 0, bal.var[i]])) / 2
names(ll.bal$all)[i] <- bal.var[i]

ll.bal$all.pw[[i]] <-
summaryR.lm(lm(formula(
paste(bal.var[i], "~ elected*votemargin")
) , data = ll.all.pw.baldata), type = "hc2")
ll.bal$all.pw[[i]]$sd <-
(sd(ll.all.pw.baldata[ll.all.pw.baldata$elected == 1, bal.var[i]]) + sd(ll.all.pw.baldata[ll.all.pw.baldata$elected == 0, bal.var[i]])) / 2
names(ll.bal$all.pw)[i] <- bal.var[i]

if (length(unique(ll.coal.pw.baldata[, bal.var[i]])) == 1) {
ll.bal$coal.pw[[i]] <- NA
}
if (length(unique(ll.coal.pw.baldata[, bal.var[i]])) > 1) {
ll.bal$coal.pw[[i]] <-
summaryR.lm(lm(formula(
paste(bal.var[i], "~ elected*votemargin")
) , data = ll.coal.pw.baldata), type = "hc2")
ll.bal$coal.pw[[i]]$sd <-
(sd(ll.coal.pw.baldata[ll.coal.pw.baldata$elected == 1, bal.var[i]]) + sd(ll.coal.pw.baldata[ll.coal.pw.baldata$elected == 0, bal.var[i]])) / 2
}
names(ll.bal$coal.pw)[i] <- bal.var[i]

if (length(unique(ll.pt.pw.baldata[, bal.var[i]])) == 1) {
ll.bal$pt.pw[[i]] <- NA
}
if (length(unique(ll.pt.pw.baldata[, bal.var[i]])) > 1) {
ll.bal$pt.pw[[i]] <-
tryCatch(
summaryR.lm(lm(formula(
paste(bal.var[i], "~ elected*votemargin")
) , data = ll.pt.pw.baldata), type = "hc2"),
error = function(e)
NA
)
if (is.na(ll.bal$pt.pw[[i]][1]) == FALSE) {
ll.bal$pt.pw[[i]]$sd <-
(sd(ll.pt.pw.baldata[ll.pt.pw.baldata$elected == 1, bal.var[i]]) + sd(ll.pt.pw.baldata[ll.pt.pw.baldata$elected == 0, bal.var[i]])) / 2
}
}
names(ll.bal$pt.pw)[i] <- bal.var[i]
ply.bal$all[[i]] <-
summaryR.lm(lm(formula(
paste(
bal.var[i],
"~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
) , data = ply.all.baldata), type = "hc2")
ply.bal$all[[i]]$sd <-
(sd(ply.all.baldata[ply.all.baldata$elected == 1, bal.var[i]]) + sd(ply.all.baldata[ply.all.baldata$elected == 0, bal.var[i]])) / 2
names(ply.bal$all)[i] <- bal.var[i]

ply.bal$all.pw[[i]] <-
summaryR.lm(lm(formula(
paste(
bal.var[i],
"~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
) , data = ply.all.pw.baldata), type = "hc2")
ply.bal$all.pw[[i]]$sd <-
(sd(ply.all.pw.baldata[ply.all.pw.baldata$elected == 1, bal.var[i]]) + sd(ply.all.pw.baldata[ply.all.pw.baldata$elected == 0, bal.var[i]])) / 2
names(ply.bal$all.pw)[i] <- bal.var[i]

if (length(unique(ply.coal.pw.baldata[, bal.var[i]])) == 1) {
ply.bal$coal.pw[[i]] <- NA
}
if (length(unique(ply.coal.pw.baldata[, bal.var[i]])) > 1) {
ply.bal$coal.pw[[i]] <-
summaryR.lm(lm(formula(
paste(
bal.var[i],
"~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
) , data = ply.coal.pw.baldata), type = "hc2")
ply.bal$coal.pw[[i]]$sd <-
(sd(ply.coal.pw.baldata[ply.coal.pw.baldata$elected == 1, bal.var[i]]) + sd(ply.coal.pw.baldata[ply.coal.pw.baldata$elected == 0, bal.var[i]])) / 2
}
names(ply.bal$coal.pw)[i] <- bal.var[i]

if (length(unique(ply.pt.pw.baldata[, bal.var[i]])) == 1) {
ply.bal$pt.pw[[i]] <- NA
}
if (length(unique(ply.pt.pw.baldata[, bal.var[i]])) > 1) {
ply.bal$pt.pw[[i]] <-
tryCatch(
summaryR.lm(lm(formula(
paste(
bal.var[i],
"~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
) , data = ply.pt.pw.baldata), type = "hc2"),
error = function(e)
NA
)
if (is.na(ply.bal$pt.pw[[i]][1]) == FALSE) {
ply.bal$pt.pw[[i]]$sd <-
(sd(ply.pt.pw.baldata[ply.pt.pw.baldata$elected == 1, bal.var[i]]) + sd(ply.pt.pw.baldata[ply.pt.pw.baldata$elected == 0, bal.var[i]])) / 2
}
}
names(ply.bal$pt.pw)[i] <- bal.var[i]

}

lo.bal <- lapply(lo.bal, function(x) {
x[is.na(x)] <- NULL
x
})
ll.bal <- lapply(ll.bal, function(x) {
x[is.na(x)] <- NULL
x
})
ply.bal <- lapply(ply.bal, function(x) {
x[is.na(x)] <- NULL
x
})
std.diff.table <- data.frame(
Estimate = c(
ldply(lo.bal, function(x)
ldply(x, function(x)
x$est))$V1,
ldply(ply.bal, function(x)
ldply(x, function(x)
coef(x)[2, 1]))$V1,
ldply(ll.bal, function(x)
ldply(x, function(x)
coef(x)[2, 1]))$V1
),
SD = c(
ldply(lo.bal, function(x)
ldply(x, function(x)
x$sd))$V1,
ldply(ply.bal, function(x)
ldply(x, function(x)
x$sd))$V1,
ldply(ll.bal, function(x)
ldply(x, function(x)
x$sd))$V1
),
Variable = c(
ldply(lo.bal, function(x)
ldply(x, function(x)
x$sd))$.id,
ldply(ply.bal, function(x)
ldply(x, function(x)
x$sd))$.id,
ldply(ll.bal, function(x)
ldply(x, function(x)
x$sd))$.id
),
Sample = c(rep(
c(
"All",
"Public Works",
"Public Works, Coalition",
"Public Works, PT"
),
sapply(lo.bal, length)
),
rep(
c(
"All",
"Public Works",
"Public Works, Coalition",
"Public Works, PT"
),
sapply(ply.bal, length)
),
rep(
c(
"All",
"Public Works",
"Public Works, Coalition",
"Public Works, PT"
),
sapply(ll.bal, length)
)),
Estimator = c(
rep("Loess", sum(sapply(lo.bal, length))),
rep("Polynomial", sum(sapply(ply.bal, length))),
rep("Local Linear", sum(sapply(ll.bal, length)))
)
)
std.diff.table$std.diff <-
std.diff.table$Estimate / std.diff.table$SD
std.diff.table$Variable <-
reorder(std.diff.table$Variable, std.diff.table$std.diff, mean)

tstat.table <- data.frame(
Estimate = c(
ldply(lo.bal, function(x)
ldply(x, function(x)
x$est))$V1,
ldply(ply.bal, function(x)
ldply(x, function(x)
coef(x)[2, 1]))$V1,
ldply(ll.bal, function(x)
ldply(x, function(x)
coef(x)[2, 1]))$V1
),
SE = c(
ldply(lo.bal, function(x)
ldply(x, function(x)
x$se))$V1,
ldply(ply.bal, function(x)
ldply(x, function(x)
coef(x)[2, 2]))$V1,
ldply(ll.bal, function(x)
ldply(x, function(x)
coef(x)[2, 2]))$V1
),
Variable = c(
ldply(lo.bal, function(x)
ldply(x, function(x)
x$sd))$.id,
ldply(ply.bal, function(x)
ldply(x, function(x)
x$sd))$.id,
ldply(ll.bal, function(x)
ldply(x, function(x)
x$sd))$.id
),
Sample = c(rep(
c(
"All",
"Public Works",
"Public Works, Coalition",
"Public Works, PT"
),
sapply(lo.bal, length)
),
rep(
c(
"All",
"Public Works",
"Public Works, Coalition",
"Public Works, PT"
),
sapply(ply.bal, length)
),
rep(
c(
"All",
"Public Works",
"Public Works, Coalition",
"Public Works, PT"
),
sapply(ll.bal, length)
)),
Estimator = c(
rep("Loess", sum(sapply(lo.bal, length))),
rep("Polynomial", sum(sapply(ply.bal, length))),
rep("Local Linear", sum(sapply(ll.bal, length)))
)
)
tstat.table$tstat <- abs(tstat.table$Estimate / tstat.table$SE)
tstat.table$Variable <-
reorder(tstat.table$Variable, tstat.table$tstat, max)

std.diff.table$Variable <- recode(std.diff.table$Variable, c("'coalvotes' = 'Coalition Votes'; 'yob' = 'Birth Year'; 'comm.donations' = 'Party Donations'; 'incumbent' = 'Incumbent'; 'contracts.0406' = 'Contracts (\\'04-\\'06)'; 'pw.con.0406' = 'Public Works Contracts (\\'04-\\'06)'; 'donations' = 'Total Donations Received'; 'pw.donations' = 'Public Works Donations Received'; 'donor.firms' = 'No. Donor Firms'; 'pw.donor.firms' = 'Percent Public Works Donors'; 'year.opened' = 'Mean Donor Year Founded'; 'commerce' = 'Percent Commerce Donors'; 'manufacture' = 'Percent Manufacturing Donors'; 'financial' = 'Percent Financial Donors'; 'agriculture' = 'Percent Agricultural Donors'; 'cand.uf.sp' = 'State - São Paulo'; 'cand.uf.mg' = 'State - Minas Gerais';  'cand.uf.rs' = 'State - Rio Grande do Sul'; 'superior.edu' = 'Higher Education'; 'occ.pol' = 'Occupation - Politician'; 'individ.donations' = 'Individual Donations'; 'numb.company.recipients' = 'Mean Donor No. Candidate Recipients'; 'party.pmdb' = 'Party - PMDB'; 'party.pfl' = 'Party - PFL'; 'total.company.donations' = 'Mean Donor Total Donations'; 'coalvotes' = 'Coalition Votes'; 'party.pt' = 'Party - PT'; 'party.psdb' = 'Party - PSDB'; 'occ.business' = 'Occupation - Business'; 'cand.uf.rj' = 'State - Rio de Janeiro'; 'cand.uf.ba' = 'State - Bahia'; 'coalseats' = 'Coalition Seats'; 'individual.donors' = 'No. Individual Donors'; 'totalDonations.winners.firm' = 'Mean Donor Donations to Winners'; 'winners.donated.to' = 'Mean Donor No. Winning Recipients'"))


tstat.table$Variable <-
recode(
tstat.table$Variable,
c(
"'coalvotes' = 'Coalition Votes'; 'yob' = 'Birth Year'; 'comm.donations' = 'Party Donations'; 'incumbent' = 'Incumbent'; 'contracts.0406' = 'Contracts (\\'04-\\'06)'; 'pw.con.0406' = 'Public Works Contracts (\\'04-\\'06)'; 'donations' = 'Total Donations Received'; 'pw.donations' = 'Public Works Donations Received'; 'donor.firms' = 'Donor Firms'; 'pw.donor.firms' = 'Percent Public Works Donors'; 'year.opened' = 'Mean Donor Year Founded'; 'commerce' = 'Percent Commerce Donors'; 'manufacture' = 'Percent Manufacturing Donors'; 'financial' = 'Percent Financial Donors'; 'agriculture' = 'Percent Agricultural Donors'; 'cand.uf.sp' = 'State - São Paulo'; 'cand.uf.mg' = 'State - Minas Gerais';  'cand.uf.rs' = 'State - Rio Grande do Sul'; 'superior.edu' = 'Higher Education'; 'occ.pol' = 'Occupation - Politician'; 'individ.donations' = 'Individual Donations'; 'numb.company.recipients' = 'Mean Donor Candidate Recipients'; 'party.pmdb' = 'Party - PMDB'; 'party.pfl' = 'Party - PFL'; 'total.company.donations' = 'Mean Donor Total Donations'; 'coalvotes' = 'Coalition Votes'; 'party.pt' = 'Party - PT'; 'party.psdb' = 'Party - PSDB'; 'occ.business' = 'Occupation - Business'; 'cand.uf.rj' = 'State - Rio de Janeiro'; 'cand.uf.ba' = 'State - Bahia'; 'coalseats' = 'Coalition Seats'; 'individual.donors' = 'Individual Donors'; 'totalDonations.winners.firm' = 'Mean Donor Donations to Winners'; 'winners.donated.to' = 'Mean Donor Winning Recipients'"
)
)

levels(std.diff.table$Sample) <-
c("All",
"Public Works",
"Public Works, Coalition",
"Public Works, PT")

levels(tstat.table$Sample) <-
c("All",
"Public Works",
"Public Works, Coalition",
"Public Works, PT")
pdf(file = "figure1.pdf",
height = 6,
width = 10)
ggplot(tstat.table,
aes(
x = tstat,
y = Variable,
shape = Sample,
color = Sample
)) + geom_point() + geom_vline(xintercept = 2,
lty = 2,
size = .2) + facet_grid(. ~ Estimator) + theme_bw() + scale_x_continuous("T Statistic") + scale_color_brewer(palette = "Set1") + labs(title = "Balance Statistics for Federal Deputies")
dev.off()

```

```{r table loess estimator, include = FALSE}

lo.all <-
with(
lo.all.data,
lo.ate(
y = log((contracts.0810 + 1) / donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all$est.unlogged <-
reais.format(exp(lo.all$tr.est) - exp(lo.all$con.est))
lo.all$num.donors <-
with(
lo.all.data,
lo.ate(
y = log(donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all$num.donors <-
mean(exp(lo.all$num.donors$tr.est),
exp(lo.all$num.donors$con.est))
lo.all$donations <-
with(
lo.all.data ,
lo.ate(
y = log(donations),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all$donations <-
reais.format(mean(exp(lo.all$donations$tr.est) , exp(lo.all$donations$con.est)) / lo.all$num.donors)
lo.all$N <-
nrow(depfed_data[abs(depfed_data$votemargin) < lo.bw &
depfed_data$donations > 0, ])

```

```{r all public works, include = FALSE}

lo.all.pw <-
with(
lo.all.pw.data,
lo.ate(
y = log((pw.con.0810 + 1) / pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all.pw$est.unlogged <-
reais.format(exp(lo.all.pw$tr.est) - exp(lo.all.pw$con.est))
lo.all.pw$num.donors <-
with(
lo.all.pw.data,
lo.ate(
y = log(pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all.pw$num.donors <-
mean(exp(lo.all.pw$num.donors$tr.est),
exp(lo.all.pw$num.donors$con.est))
lo.all.pw$donations <-
with(
lo.all.pw.data ,
lo.ate(
y = log(pw.donations),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all.pw$donations <-
reais.format(mean(
exp(lo.all.pw$donations$tr.est) ,
exp(lo.all.pw$donations$con.est)
) / lo.all.pw$num.donors)
lo.all.pw$N <- nrow(lo.all.pw.data)

```

```{r public works coalition, include = FALSE}

lo.coal.pw <-
with(
lo.coal.pw.data,
lo.ate(
y = log((pw.con.0810 + 1) / pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.coal.pw$est.unlogged <-
reais.format(exp(lo.coal.pw$tr.est) - exp(lo.coal.pw$con.est))
lo.coal.pw$num.donors <-
with(
lo.coal.pw.data,
lo.ate(
y = log(pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.coal.pw$num.donors <-
mean(exp(lo.coal.pw$num.donors$tr.est),
exp(lo.coal.pw$num.donors$con.est))
lo.coal.pw$donations <-
with(
lo.coal.pw.data ,
lo.ate(
y = log(pw.donations),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.coal.pw$donations <-
reais.format(mean(
exp(lo.coal.pw$donations$tr.est) ,
exp(lo.coal.pw$donations$con.est)
) / lo.coal.pw$num.donors)
lo.coal.pw$N <- nrow(lo.coal.pw.data)

```

```{r public works pt, include = FALSE}
lo.pt.pw <-
with(
lo.pt.pw.data,
lo.ate(
y = log((pw.con.0810 + 1) / pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.pt.pw$est.unlogged <-
reais.format(exp(lo.pt.pw$tr.est) - exp(lo.pt.pw$con.est))
lo.pt.pw$num.donors <-
with(
lo.pt.pw.data,
lo.ate(
y = log(pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.pt.pw$num.donors <-
mean(exp(lo.pt.pw$num.donors$tr.est),
exp(lo.pt.pw$num.donors$con.est))
lo.pt.pw$donations <-
with(
lo.pt.pw.data ,
lo.ate(
y = log(pw.donations),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.pt.pw$donations <-
reais.format(mean(
exp(lo.pt.pw$donations$tr.est) ,
exp(lo.pt.pw$donations$con.est)
) / lo.pt.pw$num.donors)
lo.pt.pw$N <- nrow(lo.pt.pw.data)


###Local Linear
##All candidates
ll.all <-
summaryR.lm(lm(log((contracts.0810 + 1) / donor.firms) ~ elected * votemargin, data = ll.all.data), type = "hc2")
ll.all$est <- coef(ll.all)[2, 1]
ll.all$se <- coef(ll.all)[2, 2]
ll.all$est.unlogged <-
reais.format(exp(coef(ll.all)[1, 1] + coef(ll.all)[2, 1]) - exp(coef(ll.all)[1, 1]))
ll.all$num.donors <-
summaryR.lm(lm(log(donor.firms) ~ elected * votemargin , data = ll.all.data), type = "hc2")
ll.all$num.donors <-
mean(exp(coef(ll.all$num.donors)[1, 1]), exp(coef(ll.all$num.donors)[1, 1] + coef(ll.all$num.donors)[2, 1]))
ll.all$donations <-
summaryR.lm(lm(log(donations) ~ elected * votemargin , data = ll.all.data), type = "hc2")
ll.all$donations <-
reais.format(mean(exp(coef(ll.all$donations)[1, 1]), exp(
coef(ll.all$donations)[1, 1] + coef(ll.all$donations)[2, 1]
)))
ll.all$N <- nrow(ll.all.data)

##Public works
ll.all.pw <-
summaryR.lm(lm(log((pw.con.0810 + 1) / pw.donor.firms) ~ elected * votemargin, data = ll.all.pw.data), type = "hc2")
ll.all.pw$est <- coef(ll.all.pw)[2, 1]
ll.all.pw$se <- coef(ll.all.pw)[2, 2]
ll.all.pw$est.unlogged <-
reais.format(exp(coef(ll.all.pw)[1, 1] + coef(ll.all.pw)[2, 1]) - exp(coef(ll.all.pw)[1, 1]))
ll.all.pw$num.donors <-
summaryR.lm(lm(log(pw.donor.firms) ~ elected * votemargin , data = ll.all.pw.data), type = "hc2")
ll.all.pw$num.donors <-
mean(exp(coef(ll.all.pw$num.donors)[1, 1]), exp(coef(ll.all.pw$num.donors)[1, 1] + coef(ll.all.pw$num.donors)[2, 1]))
ll.all.pw$donations <-
summaryR.lm(lm(log(pw.donations) ~ elected * votemargin , data = ll.all.pw.data), type = "hc2")
ll.all.pw$donations <-
reais.format(mean(exp(coef(
ll.all.pw$donations
)[1, 1]), exp(
coef(ll.all.pw$donations)[1, 1] + coef(ll.all.pw$donations)[2, 1]
)))
ll.all.pw$N <- nrow(ll.all.pw.data)

##Coalition, public works
ll.coal.pw <-
summaryR.lm(lm(log((pw.con.0810 + 1) / pw.donor.firms) ~ elected * votemargin, data = ll.coal.pw.data), type = "hc2")
ll.coal.pw$est <- coef(ll.coal.pw)[2, 1]
ll.coal.pw$se <- coef(ll.coal.pw)[2, 2]
ll.coal.pw$est.unlogged <-
reais.format(exp(coef(ll.coal.pw)[1, 1] + coef(ll.coal.pw)[2, 1]) - exp(coef(ll.coal.pw)[1, 1]))
ll.coal.pw$num.donors <-
summaryR.lm(lm(log(pw.donor.firms) ~ elected * votemargin , data = ll.coal.pw.data), type = "hc2")
ll.coal.pw$num.donors <-
mean(exp(coef(ll.coal.pw$num.donors)[1, 1]), exp(coef(ll.coal.pw$num.donors)[1, 1] + coef(ll.coal.pw$num.donors)[2, 1]))
ll.coal.pw$donations <-
summaryR.lm(lm(log(pw.donations) ~ elected * votemargin , data = ll.coal.pw.data), type = "hc2")
ll.coal.pw$donations <-
reais.format(mean(exp(coef(
ll.coal.pw$donations
)[1, 1]), exp(
coef(ll.coal.pw$donations)[1, 1] + coef(ll.coal.pw$donations)[2, 1]
)))
ll.coal.pw$N <- nrow(ll.coal.pw.data)

##PT. public works
ll.pt.pw <-
summaryR.lm(lm(log((pw.con.0810 + 1) / pw.donor.firms) ~ elected * votemargin, data = ll.pt.pw.data), type = "hc2")
ll.pt.pw$est <- coef(ll.pt.pw)[2, 1]
ll.pt.pw$se <- coef(ll.pt.pw)[2, 2]
ll.pt.pw$est.unlogged <-
reais.format(exp(coef(ll.pt.pw)[1, 1] + coef(ll.pt.pw)[2, 1]) - exp(coef(ll.pt.pw)[1, 1]))
ll.pt.pw$num.donors <-
summaryR.lm(lm(log(pw.donor.firms) ~ elected * votemargin , data = ll.pt.pw.data), type = "hc2")
ll.pt.pw$num.donors <-
mean(exp(coef(ll.pt.pw$num.donors)[1, 1]), exp(coef(ll.pt.pw$num.donors)[1, 1] + coef(ll.pt.pw$num.donors)[2, 1]))
ll.pt.pw$donations <-
summaryR.lm(lm(log(pw.donations) ~ elected * votemargin , data = ll.pt.pw.data), type = "hc2")
ll.pt.pw$donations <-
reais.format(mean(exp(coef(ll.pt.pw$donations)[1, 1]), exp(
coef(ll.pt.pw$donations)[1, 1] + coef(ll.pt.pw$donations)[2, 1]
)))
ll.pt.pw$N <- nrow(ll.pt.pw.data)

###Higher Order Polynomial Specification

##All candidates
ply.all <-
summaryR.lm(lm(as.formula(
paste(
"log((contracts.0810 + 1)/donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)   , data = ply.all.data))
ply.all$est <- coef(ply.all)[2, 1]
ply.all$se <- coef(ply.all)[2, 2]
ply.all$est.unlogged <-
reais.format(exp(coef(ply.all)[1, 1] + coef(ply.all)[2, 1]) - exp(coef(ply.all)[1, 1]))
ply.all$num.donors <-
summaryR.lm(lm(as.formula(
paste(
"log(donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.data), type = "hc2")
ply.all$num.donors <-
mean(exp(coef(ply.all$num.donors)[1, 1]), exp(coef(ply.all$num.donors)[1, 1] + coef(ply.all$num.donors)[2, 1]))
ply.all$donations <-
summaryR.lm(lm(as.formula(
paste(
"log((donations)) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.data), type = "hc2")
ply.all$donations <-
reais.format(mean(exp(coef(ply.all$donations)[1, 1]), exp(
coef(ply.all$donations)[1, 1] + coef(ply.all$donations)[2, 1]
)))
ply.all$N <- nrow(ply.all.data)

##Public works
ply.all.pw <-
summaryR.lm(lm(as.formula(
paste(
"log((pw.con.0810 + 1)/pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.pw.data), type = "hc2")
ply.all.pw$est <- coef(ply.all.pw)[2, 1]
ply.all.pw$se <- coef(ply.all.pw)[2, 2]
ply.all.pw$est.unlogged <-
reais.format(exp(coef(ply.all.pw)[1, 1] + coef(ply.all.pw)[2, 1]) - exp(coef(ply.all.pw)[1, 1]))
ply.all.pw$num.donors <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.pw.data), type = "hc2")
ply.all.pw$num.donors <-
mean(exp(coef(ply.all.pw$num.donors)[1, 1]), exp(coef(ply.all.pw$num.donors)[1, 1] + coef(ply.all.pw$num.donors)[2, 1]))
ply.all.pw$donations <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donations) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.pw.data), type = "hc2")
ply.all.pw$donations <-
reais.format(mean(exp(coef(
ply.all.pw$donations
)[1, 1]), exp(
coef(ply.all.pw$donations)[1, 1] + coef(ply.all.pw$donations)[2, 1]
)))
ply.all.pw$N <- nrow(ply.all.pw.data)

##Coalition, public works
ply.coal.pw <-
summaryR.lm(lm(as.formula(
paste(
"log((pw.con.0810 + 1)/pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.coal.pw.data), type = "hc2")
ply.coal.pw$est <- coef(ply.coal.pw)[2, 1]
ply.coal.pw$se <- coef(ply.coal.pw)[2, 2]
ply.coal.pw$est.unlogged <-
reais.format(exp(coef(ply.coal.pw)[1, 1] + coef(ply.coal.pw)[2, 1]) - exp(coef(ply.coal.pw)[1, 1]))
ply.coal.pw$num.donors <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.coal.pw.data), type = "hc2")
ply.coal.pw$num.donors <-
mean(exp(coef(ply.coal.pw$num.donors)[1, 1]), exp(
coef(ply.coal.pw$num.donors)[1, 1] + coef(ply.coal.pw$num.donors)[2, 1]
))
ply.coal.pw$donations <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donations) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
) , data = ply.coal.pw.data), type = "hc2")
ply.coal.pw$donations <-
reais.format(mean(exp(coef(
ply.coal.pw$donations
)[1, 1]), exp(
coef(ply.coal.pw$donations)[1, 1] + coef(ply.coal.pw$donations)[2, 1]
)))
ply.coal.pw$N <- nrow(ply.coal.pw.data)

##PT. public works
ply.pt.pw <-
summaryR.lm(lm(as.formula(
paste(
"log((pw.con.0810 + 1)/pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
) , data = ply.pt.pw.data))
ply.pt.pw$est <- coef(ply.pt.pw)[2, 1]
ply.pt.pw$se <- coef(ply.pt.pw)[2, 2]
ply.pt.pw$est.unlogged <-
reais.format(exp(coef(ply.pt.pw)[1, 1] + coef(ply.pt.pw)[2, 1]) - exp(coef(ply.pt.pw)[1, 1]))
ply.pt.pw$num.donors <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.pt.pw.data), type = "hc2")
ply.pt.pw$num.donors <-
mean(exp(coef(ply.pt.pw$num.donors)[1, 1]), exp(coef(ply.pt.pw$num.donors)[1, 1] + coef(ply.pt.pw$num.donors)[2, 1]))
ply.pt.pw$donations <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donations) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
), data = ply.pt.pw.data), type = "hc2")
ply.pt.pw$donations <-
reais.format(mean(exp(coef(
ply.pt.pw$donations
)[1, 1]), exp(
coef(ply.pt.pw$donations)[1, 1] + coef(ply.pt.pw$donations)[2, 1]
)))
ply.pt.pw$N <- nrow(ply.pt.pw.data)
```


```{r table}
#Gather all results into one table
raw.results.table <- data.frame(cbind(
round(
c(
lo.all$est,
lo.all.pw$est,
lo.coal.pw$est,
lo.pt.pw$est,
ply.all$est,
ply.all.pw$est,
ply.coal.pw$est,
ply.pt.pw$est,
ll.all$est,
ll.all.pw$est,
ll.coal.pw$est,
ll.pt.pw$est
),
2
),
round(
c(
lo.all$se,
lo.all.pw$se,
lo.coal.pw$se,
lo.pt.pw$se,
ply.all$se,
ply.all.pw$se,
ply.coal.pw$se,
ply.pt.pw$se,
ll.all$se,
ll.all.pw$se,
ll.coal.pw$se,
ll.pt.pw$se
),
2
),
c(
lo.all$est.unlogged,
lo.all.pw$est.unlogged,
lo.coal.pw$est.unlogged,
lo.pt.pw$est.unlogged,
ply.all$est.unlogged,
ply.all.pw$est.unlogged,
ply.coal.pw$est.unlogged,
ply.pt.pw$est.unlogged,
ll.all$est.unlogged,
ll.all.pw$est.unlogged,
ll.coal.pw$est.unlogged,
ll.pt.pw$est.unlogged
),
c(
lo.all$donations,
lo.all.pw$donations,
lo.coal.pw$donations,
lo.pt.pw$donations,
ply.all$donations,
ply.all.pw$donations,
ply.coal.pw$donations,
ply.pt.pw$donations,
ll.all$donations,
ll.all.pw$donations,
ll.coal.pw$donations,
ll.pt.pw$donations
),
c(
lo.all$N,
lo.all.pw$N,
lo.coal.pw$N,
lo.pt.pw$N,
ply.all$N,
ply.all.pw$N,
ply.coal.pw$N,
ply.pt.pw$N,
ll.all$N,
ll.all.pw$N,
ll.coal.pw$N,
ll.pt.pw$N
)
))


names(raw.results.table) <-
c("$\\tau_{RD}$",
"Standard Error",
"$\\tau_{RD}$, unlogged",
"Mean Donation" ,
"N")
bottom.note <-
paste(
"Dependent variable is the log of the average value of contracts (plus one) received by a candidate's corporate donors, January 2008--September 2010. ``PT'' candidates are those from the ruling Worker's Party. ``Coalition'' candidates are those from the parties listed in footnote 12. The unlogged treatment effect is given by $exp(E[Y_{ij}(1)|M_{ij} =0]) - exp(E[Y_{ij}(0)|M_{ij} =0])$. ``Mean Donation'' is the estimated donation per firm for candidates at the discontinuity.  The loess specification uses a bandwidth of ",
prettyNum(lo.bw, big.mark = ",", scientific = FALSE),
" votes and a span of ",
span,
". The local linear and polynomial specifications use bandwidths of ",
prettyNum(ll.bw, big.mark = ",", scientific = FALSE),
" and ",
prettyNum(ply.bw, big.mark = ",", scientific = FALSE),
" votes, respectively.  Loess standard errors are bootstrapped; others are heteroskedasticity-robust.",
sep = ""
)

#Note: The following command creates a latex table that can only be compiled when using the "ctable" latex package.
#Note: The results in this latex table correspond to the results in the left half of Table 1
raw.results.table.latex <-
latex(
raw.results.table,
cdec = c(2, 2, 0, 0, 0),
file = "table1_all_contracts.tex",
col.just = rep("c", 5),
rowname = c(
"All",
"Public works donations",
"Public works, coalition",
"Public works, PT",
"All",
"Public works donations",
"Public works, coalition",
"Public works, PT",
"All",
"Public works donations",
"Public works, coalition",
"Public works, PT"
),
rowlabel = "Sample",
caption = "The Effect of Electoral Victory on Future Federal Government Contracts",
insert.bottom = bottom.note,
rgroup = c(
"Loess Estimator",
"Polynomial Estimator",
"Local Linear Estimator"
),
n.rgroup = c(4, 4, 4),
booktabs = FALSE,
ctable = TRUE,
where = "htp"
)

```

```{r DNIT analysis, include = FALSE}
##DNIT Analysis

###Loess Estimator
##All Donation Recipients
lo.all <-
with(
lo.all.data[lo.all.data$donations > 0, ],
lo.ate(
y = log((contracts.dnit.0810 + 1) / donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all$est.unlogged <-
reais.format(exp(lo.all$tr.est) - exp(lo.all$con.est))
lo.all$num.donors <-
with(
lo.all.data[lo.all.data$donations > 0,],
lo.ate(
y = log(donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all$num.donors <-
mean(exp(lo.all$num.donors$tr.est),
exp(lo.all$num.donors$con.est))
lo.all$donations <-
with(
lo.all.data[lo.all.data$donations > 0,] ,
lo.ate(
y = log(donations),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all$donations <-
reais.format(mean(exp(lo.all$donations$tr.est) , exp(lo.all$donations$con.est)) / lo.all$num.donors)
lo.all$N <-
nrow(depfed_data[abs(depfed_data$votemargin) < lo.bw  &
depfed_data$donations > 0, ])

##Public Works, all
lo.all.pw <-
with(
lo.all.pw.data[lo.all.pw.data$pw.donations > 0,],
lo.ate(
y = log((pwcontracts.dnit.0810 + 1) / pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all.pw$est.unlogged <-
reais.format(exp(lo.all.pw$tr.est) - exp(lo.all.pw$con.est))
lo.all.pw$num.donors <-
with(
lo.all.pw.data[lo.all.pw.data$pw.donations > 0,],
lo.ate(
y = log(pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all.pw$num.donors <-
mean(exp(lo.all.pw$num.donors$tr.est),
exp(lo.all.pw$num.donors$con.est))
lo.all.pw$donations <-
with(
lo.all.pw.data[lo.all.pw.data$pw.donations > 0,] ,
lo.ate(
y = log(pw.donations),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.all.pw$donations <-
reais.format(mean(
exp(lo.all.pw$donations$tr.est) ,
exp(lo.all.pw$donations$con.est)
) / lo.all.pw$num.donors)
lo.all.pw$N <-
nrow(lo.all.pw.data[lo.all.pw.data$pw.donations > 0,])

##Public works, coalition
lo.coal.pw <-
with(
lo.coal.pw.data[lo.coal.pw.data$pw.donations > 0,],
lo.ate(
y = log((pwcontracts.dnit.0810 + 1) / pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.coal.pw$est.unlogged <-
reais.format(exp(lo.coal.pw$tr.est) - exp(lo.coal.pw$con.est))
lo.coal.pw$num.donors <-
with(
lo.coal.pw.data[lo.coal.pw.data$pw.donations > 0,],
lo.ate(
y = log(pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.coal.pw$num.donors <-
mean(exp(lo.coal.pw$num.donors$tr.est),
exp(lo.coal.pw$num.donors$con.est))
lo.coal.pw$donations <-
with(
lo.coal.pw.data[lo.coal.pw.data$pw.donations > 0,] ,
lo.ate(
y = log(pw.donations),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.coal.pw$donations <-
reais.format(mean(
exp(lo.coal.pw$donations$tr.est) ,
exp(lo.coal.pw$donations$con.est)
) / lo.coal.pw$num.donors)
lo.coal.pw$N <- nrow(lo.coal.pw.data)

##Public works, PT
lo.pt.pw <-
with(
lo.pt.pw.data[lo.pt.pw.data$pw.donations > 0 ,],
lo.ate(
y = log((pwcontracts.dnit.0810 + 1) / pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.pt.pw$est.unlogged <-
reais.format(exp(lo.pt.pw$tr.est) - exp(lo.pt.pw$con.est))
lo.pt.pw$num.donors <-
with(
lo.pt.pw.data[lo.pt.pw.data$pw.donations > 0 ,],
lo.ate(
y = log(pw.donor.firms),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.pt.pw$num.donors <-
mean(exp(lo.pt.pw$num.donors$tr.est),
exp(lo.pt.pw$num.donors$con.est))
lo.pt.pw$donations <-
with(
lo.pt.pw.data[lo.pt.pw.data$pw.donations > 0 ,] ,
lo.ate(
y = log(pw.donations),
treat = elected,
force.var = votemargin,
span = span,
R = num.boots,
degree = lo.degree
)
)
lo.pt.pw$donations <-
reais.format(mean(
exp(lo.pt.pw$donations$tr.est) ,
exp(lo.pt.pw$donations$con.est)
) / lo.pt.pw$num.donors)
lo.pt.pw$N <- nrow(lo.pt.pw.data)

###Local Linear
##All candidates
ll.all <-
summaryR.lm(lm(log((
contracts.dnit.0810 + 1
) / donor.firms) ~ elected * votemargin, data = ll.all.data[ll.all.data$donations > 0,]), type = "hc2")
ll.all$est <- coef(ll.all)[2, 1]
ll.all$se <- coef(ll.all)[2, 2]
ll.all$est.unlogged <-
reais.format(exp(coef(ll.all)[1, 1] + coef(ll.all)[2, 1]) - exp(coef(ll.all)[1, 1]))
ll.all$num.donors <-
summaryR.lm(lm(log(donor.firms) ~ elected * votemargin , data = ll.all.data[ll.all.data$donations > 0,]), type = "hc2")
ll.all$num.donors <-
mean(exp(coef(ll.all$num.donors)[1, 1]), exp(coef(ll.all$num.donors)[1, 1] + coef(ll.all$num.donors)[2, 1]))
ll.all$donations <-
summaryR.lm(lm(log(donations) ~ elected * votemargin , data = ll.all.data[ll.all.data$donations > 0,]), type = "hc2")
ll.all$donations <-
reais.format(mean(exp(coef(ll.all$donations)[1, 1]), exp(
coef(ll.all$donations)[1, 1] + coef(ll.all$donations)[2, 1]
)))
ll.all$N <- nrow(ll.all.data)

##Public works
ll.all.pw <-
summaryR.lm(lm(log((pwcontracts.dnit.0810 + 1) / pw.donor.firms
) ~ elected * votemargin, data = ll.all.pw.data[ll.all.pw.data$pw.donations > 0,]), type = "hc2")
ll.all.pw$est <- coef(ll.all.pw)[2, 1]
ll.all.pw$se <- coef(ll.all.pw)[2, 2]
ll.all.pw$est.unlogged <-
reais.format(exp(coef(ll.all.pw)[1, 1] + coef(ll.all.pw)[2, 1]) - exp(coef(ll.all.pw)[1, 1]))
ll.all.pw$num.donors <-
summaryR.lm(lm(log(pw.donor.firms) ~ elected * votemargin , data = ll.all.pw.data[ll.all.pw.data$pw.donations > 0,]), type = "hc2")
ll.all.pw$num.donors <-
mean(exp(coef(ll.all.pw$num.donors)[1, 1]), exp(coef(ll.all.pw$num.donors)[1, 1] + coef(ll.all.pw$num.donors)[2, 1]))
ll.all.pw$donations <-
summaryR.lm(lm(log(pw.donations) ~ elected * votemargin , data = ll.all.pw.data[ll.all.pw.data$pw.donations > 0,]), type = "hc2")
ll.all.pw$donations <-
reais.format(mean(exp(coef(
ll.all.pw$donations
)[1, 1]), exp(
coef(ll.all.pw$donations)[1, 1] + coef(ll.all.pw$donations)[2, 1]
)))
ll.all.pw$N <- nrow(ll.all.pw.data)

##Coalition, public works
ll.coal.pw <-
summaryR.lm(lm(log((pwcontracts.dnit.0810 + 1) / pw.donor.firms
) ~ elected * votemargin, data = ll.coal.pw.data[ll.coal.pw.data$pw.donations > 0,]), type = "hc2")
ll.coal.pw$est <- coef(ll.coal.pw)[2, 1]
ll.coal.pw$se <- coef(ll.coal.pw)[2, 2]
ll.coal.pw$est.unlogged <-
reais.format(exp(coef(ll.coal.pw)[1, 1] + coef(ll.coal.pw)[2, 1]) - exp(coef(ll.coal.pw)[1, 1]))
ll.coal.pw$num.donors <-
summaryR.lm(lm(log(pw.donor.firms) ~ elected * votemargin , data = ll.coal.pw.data[ll.coal.pw.data$pw.donations > 0,]), type = "hc2")
ll.coal.pw$num.donors <-
mean(exp(coef(ll.coal.pw$num.donors)[1, 1]), exp(coef(ll.coal.pw$num.donors)[1, 1] + coef(ll.coal.pw$num.donors)[2, 1]))
ll.coal.pw$donations <-
summaryR.lm(lm(log(pw.donations) ~ elected * votemargin , data = ll.coal.pw.data[ll.coal.pw.data$pw.donations > 0,]), type = "hc2")
ll.coal.pw$donations <-
reais.format(mean(exp(coef(
ll.coal.pw$donations
)[1, 1]), exp(
coef(ll.coal.pw$donations)[1, 1] + coef(ll.coal.pw$donations)[2, 1]
)))
ll.coal.pw$N <- nrow(ll.coal.pw.data)

##PT. public works
ll.pt.pw <-
summaryR.lm(lm(log((pwcontracts.dnit.0810 + 1) / pw.donor.firms
) ~ elected * votemargin, data = ll.pt.pw.data[ll.pt.pw.data$pw.donations > 0,]), type = "hc2")
ll.pt.pw$est <- coef(ll.pt.pw)[2, 1]
ll.pt.pw$se <- coef(ll.pt.pw)[2, 2]
ll.pt.pw$est.unlogged <-
reais.format(exp(coef(ll.pt.pw)[1, 1] + coef(ll.pt.pw)[2, 1]) - exp(coef(ll.pt.pw)[1, 1]))
ll.pt.pw$num.donors <-
summaryR.lm(lm(log(pw.donor.firms) ~ elected * votemargin , data = ll.pt.pw.data[ll.pt.pw.data$pw.donations > 0,]), type = "hc2")
ll.pt.pw$num.donors <-
mean(exp(coef(ll.pt.pw$num.donors)[1, 1]), exp(coef(ll.pt.pw$num.donors)[1, 1] + coef(ll.pt.pw$num.donors)[2, 1]))
ll.pt.pw$donations <-
summaryR.lm(lm(log(pw.donations) ~ elected * votemargin , data = ll.pt.pw.data[ll.pt.pw.data$pw.donations > 0,]), type = "hc2")
ll.pt.pw$donations <-
reais.format(mean(exp(coef(ll.pt.pw$donations)[1, 1]), exp(
coef(ll.pt.pw$donations)[1, 1] + coef(ll.pt.pw$donations)[2, 1]
)))
ll.pt.pw$N <- nrow(ll.pt.pw.data)

###Higher Order Polynomial Specification

##All candidates
ply.all <-
summaryR.lm(lm(as.formula(
paste(
"log((contracts.dnit.0810 + 1)/donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)   , data = ply.all.data[ply.all.data$donations > 0,]))
ply.all$est <- coef(ply.all)[2, 1]
ply.all$se <- coef(ply.all)[2, 2]
ply.all$est.unlogged <-
reais.format(exp(coef(ply.all)[1, 1] + coef(ply.all)[2, 1]) - exp(coef(ply.all)[1, 1]))
ply.all$num.donors <-
summaryR.lm(lm(as.formula(
paste(
"log(donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.data[ply.all.data$donations > 0,]), type = "hc2")
ply.all$num.donors <-
mean(exp(coef(ply.all$num.donors)[1, 1]), exp(coef(ply.all$num.donors)[1, 1] + coef(ply.all$num.donors)[2, 1]))
ply.all$donations <-
summaryR.lm(lm(as.formula(
paste(
"log((donations)) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.data[ply.all.data$donations > 0,]), type = "hc2")
ply.all$donations <-
reais.format(mean(exp(coef(ply.all$donations)[1, 1]), exp(
coef(ply.all$donations)[1, 1] + coef(ply.all$donations)[2, 1]
)))
ply.all$N <- nrow(ply.all.data[ply.all.data$donations > 0,])

##Public works
ply.all.pw <-
summaryR.lm(lm(as.formula(
paste(
"log((pwcontracts.dnit.0810 + 1)/pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.pw.data[ply.all.pw.data$pw.donations > 0,]), type = "hc2")
ply.all.pw$est <- coef(ply.all.pw)[2, 1]
ply.all.pw$se <- coef(ply.all.pw)[2, 2]
ply.all.pw$est.unlogged <-
reais.format(exp(coef(ply.all.pw)[1, 1] + coef(ply.all.pw)[2, 1]) - exp(coef(ply.all.pw)[1, 1]))
ply.all.pw$num.donors <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.pw.data[ply.all.pw.data$pw.donations > 0,]), type = "hc2")
ply.all.pw$num.donors <-
mean(exp(coef(ply.all.pw$num.donors)[1, 1]), exp(coef(ply.all.pw$num.donors)[1, 1] + coef(ply.all.pw$num.donors)[2, 1]))
ply.all.pw$donations <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donations) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.all.pw.data[ply.all.pw.data$pw.donations > 0,]), type = "hc2")
ply.all.pw$donations <-
reais.format(mean(exp(coef(
ply.all.pw$donations
)[1, 1]), exp(
coef(ply.all.pw$donations)[1, 1] + coef(ply.all.pw$donations)[2, 1]
)))
ply.all.pw$N <-
nrow(ply.all.pw.data[ply.all.pw.data$pw.donations > 0,])

##Coalition, public works
ply.coal.pw <-
summaryR.lm(lm(as.formula(
paste(
"log((pwcontracts.dnit.0810 + 1)/pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.coal.pw.data[ply.coal.pw.data$pw.donations > 0,]), type = "hc2")
ply.coal.pw$est <- coef(ply.coal.pw)[2, 1]
ply.coal.pw$se <- coef(ply.coal.pw)[2, 2]
ply.coal.pw$est.unlogged <-
reais.format(exp(coef(ply.coal.pw)[1, 1] + coef(ply.coal.pw)[2, 1]) - exp(coef(ply.coal.pw)[1, 1]))
ply.coal.pw$num.donors <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.coal.pw.data[ply.coal.pw.data$pw.donations > 0,]), type = "hc2")
ply.coal.pw$num.donors <-
mean(exp(coef(ply.coal.pw$num.donors)[1, 1]), exp(
coef(ply.coal.pw$num.donors)[1, 1] + coef(ply.coal.pw$num.donors)[2, 1]
))
ply.coal.pw$donations <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donations) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
) , data = ply.coal.pw.data[ply.coal.pw.data$pw.donations > 0,]), type = "hc2")
ply.coal.pw$donations <-
reais.format(mean(exp(coef(
ply.coal.pw$donations
)[1, 1]), exp(
coef(ply.coal.pw$donations)[1, 1] + coef(ply.coal.pw$donations)[2, 1]
)))
ply.coal.pw$N <- nrow(ply.coal.pw.data)

##PT. public works
ply.pt.pw <-
summaryR.lm(lm(as.formula(
paste(
"log((pwcontracts.dnit.0810 + 1)/pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
) , data = ply.pt.pw.data[ply.pt.pw.data$pw.donations > 0,]))
ply.pt.pw$est <- coef(ply.pt.pw)[2, 1]
ply.pt.pw$se <- coef(ply.pt.pw)[2, 2]
ply.pt.pw$est.unlogged <-
reais.format(exp(coef(ply.pt.pw)[1, 1] + coef(ply.pt.pw)[2, 1]) - exp(coef(ply.pt.pw)[1, 1]))
ply.pt.pw$num.donors <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donor.firms) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
)  , data = ply.pt.pw.data[ply.pt.pw.data$pw.donations > 0,]), type = "hc2")
ply.pt.pw$num.donors <-
mean(exp(coef(ply.pt.pw$num.donors)[1, 1]), exp(coef(ply.pt.pw$num.donors)[1, 1] + coef(ply.pt.pw$num.donors)[2, 1]))
ply.pt.pw$donations <-
summaryR.lm(lm(as.formula(
paste(
"log(pw.donations) ~ elected * votemargin + ",
paste(
"I(votemargin^",
2:poly.order,
") * elected",
sep = "",
collapse = " + "
)
)
), data = ply.pt.pw.data[ply.pt.pw.data$pw.donations > 0,]), type = "hc2")
ply.pt.pw$donations <-
reais.format(mean(exp(coef(
ply.pt.pw$donations
)[1, 1]), exp(
coef(ply.pt.pw$donations)[1, 1] + coef(ply.pt.pw$donations)[2, 1]
)))
ply.pt.pw$N <-
nrow(ply.pt.pw.data[ply.pt.pw.data$pw.donations > 0,])


dnit.results.table <- data.frame(cbind(
round(
c(
lo.all$est,
lo.all.pw$est,
lo.coal.pw$est,
lo.pt.pw$est,
ply.all$est,
ply.all.pw$est,
ply.coal.pw$est,
ply.pt.pw$est,
ll.all$est,
ll.all.pw$est,
ll.coal.pw$est,
ll.pt.pw$est
),
2
),
round(
c(
lo.all$se,
lo.all.pw$se,
lo.coal.pw$se,
lo.pt.pw$se,
ply.all$se,
ply.all.pw$se,
ply.coal.pw$se,
ply.pt.pw$se,
ll.all$se,
ll.all.pw$se,
ll.coal.pw$se,
ll.pt.pw$se
),
2
),
c(
lo.all$est.unlogged,
lo.all.pw$est.unlogged,
lo.coal.pw$est.unlogged,
lo.pt.pw$est.unlogged,
ply.all$est.unlogged,
ply.all.pw$est.unlogged,
ply.coal.pw$est.unlogged,
ply.pt.pw$est.unlogged,
ll.all$est.unlogged,
ll.all.pw$est.unlogged,
ll.coal.pw$est.unlogged,
ll.pt.pw$est.unlogged
),
c(
lo.all$donations,
lo.all.pw$donations,
lo.coal.pw$donations,
lo.pt.pw$donations,
ply.all$donations,
ply.all.pw$donations,
ply.coal.pw$donations,
ply.pt.pw$donations,
ll.all$donations,
ll.all.pw$donations,
ll.coal.pw$donations,
ll.pt.pw$donations
),
c(
lo.all$N,
lo.all.pw$N,
lo.coal.pw$N,
lo.pt.pw$N,
ply.all$N,
ply.all.pw$N,
ply.coal.pw$N,
ply.pt.pw$N,
ll.all$N,
ll.all.pw$N,
ll.coal.pw$N,
ll.pt.pw$N
)
))


names(dnit.results.table) <-
c("$\\tau_{RD}$",
"SE",
"$\\tau_{RD}$, unlogged",
"Mean Donation" ,
"N")
bottom.note <-
paste(
"Dependent variable is the log of the average value of contracts (plus one) issued by DNIT that are received by a candidate's corporate donors, January 2008--September 2010. ``Coalition'' candidates are those from the PMDB, PP, PV, PSB, PC do B, PDT, PL, and PRONA in 2006. The unlogged treatment effect is given by $exp(E[Y_{ij}(1)|M_{ij} =0]) - exp(E[Y_{ij}(0)|M_{ij} =0])$. ``Mean Donation'' is the estimated donation per firm for candidates at the discontinuity.  The loess specification uses a bandwidth of ",
prettyNum(lo.bw, big.mark = ",", scientific = FALSE),
" votes and a span of ",
span,
". The local linear and polynomial specifications use bandwidths of ",
prettyNum(ll.bw, big.mark = ",", scientific = FALSE),
" and ",
prettyNum(ply.bw, big.mark = ",", scientific = FALSE),
" votes, respectively.  Loess standard errors are bootstrapped; others are heteroskedasticity-robust.",
sep = ""
)

#Note: The following command creates a latex table that can only be compiled when using the "ctable" latex package.
#Note: The results in this latex table correspond to the results in the right half of Table 1
dnit.results.table.latex <-
latex(
dnit.results.table,
cdec = c(2, 2, 0, 0, 0),
file = "table1_dnit_contracts.tex",
col.just = rep("c", 5),
rowname = c(
"All",
"Pub. works donations",
"Pub. works, coalition",
"Pub. works, PT",
"All",
"Pub. works donations",
"Pub. works, coalition",
"Pub. works, PT",
"All",
"Pub. works donations",
"Pub. works, coalition",
"Pub. works, PT"
),
rowlabel = "Sample",
caption = "The Effect of Electoral Victory on Future Contracts from the National Department of Transportation Infrastructure (DNIT).",
insert.bottom = bottom.note,
rgroup = c(
"Loess Estimator",
"Polynomial Estimator",
"Local Linear Estimator"
),
n.rgroup = c(4, 4, 4),
booktabs = FALSE,
ctable = TRUE,
where = "htp"
)

```

# References 
[@boas2014spoils]
